{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { each, get, omit, set } from '@antv/util';\nimport { annotation as baseAnnotation, interaction, theme, tooltip } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { deepAssign, findViewById, flow, pick } from '../../utils';\nimport { addViewAnimation } from '../../utils/view';\nimport { MEDIAN_FIELD, MEDIAN_VIEW_ID, MIN_MAX_FIELD, MIN_MAX_VIEW_ID, QUANTILE_FIELD, QUANTILE_VIEW_ID, VIOLIN_SIZE_FIELD, VIOLIN_VIEW_ID, VIOLIN_Y_FIELD, X_FIELD } from './constant';\nimport { transformViolinData } from './utils';\nvar TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\nvar adjustCfg = [{\n  type: 'dodge',\n  marginRatio: 1 / 32\n}];\n/** 处理数据 */\nfunction data(params) {\n  var chart = params.chart,\n    options = params.options;\n  chart.data(transformViolinData(options));\n  return params;\n}\n/** 小提琴轮廓 */\nfunction violinView(params) {\n  var chart = params.chart,\n    options = params.options;\n  var seriesField = options.seriesField,\n    color = options.color,\n    _a = options.shape,\n    shape = _a === void 0 ? 'violin' : _a,\n    violinStyle = options.violinStyle,\n    tooltip = options.tooltip,\n    state = options.state;\n  var view = chart.createView({\n    id: VIOLIN_VIEW_ID\n  });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      violin: {\n        style: violinStyle,\n        color: color,\n        shape: shape\n      },\n      state: state\n    }\n  });\n  view.geometries[0].adjust(adjustCfg);\n  return params;\n}\n/** 箱线 */\nfunction boxView(params) {\n  var chart = params.chart,\n    options = params.options;\n  var seriesField = options.seriesField,\n    color = options.color,\n    tooltip = options.tooltip,\n    box = options.box;\n  // 如果配置 `box` 为 false ，不渲染内部箱线图\n  if (box === false) return params;\n  // 边缘线\n  var minMaxView = chart.createView({\n    id: MIN_MAX_VIEW_ID\n  });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 1,\n        style: {\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  minMaxView.geometries[0].adjust(adjustCfg);\n  // 四分点位\n  var quantileView = chart.createView({\n    id: QUANTILE_VIEW_ID\n  });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color: color,\n        size: 8,\n        style: {\n          fillOpacity: 1\n        }\n      }\n    }\n  });\n  quantileView.geometries[0].adjust(adjustCfg);\n  // 中位值\n  var medianView = chart.createView({\n    id: MEDIAN_VIEW_ID\n  });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: __assign({\n        fields: TOOLTIP_FIELDS\n      }, tooltip),\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color: color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0\n        }\n      }\n    }\n  });\n  medianView.geometries[0].adjust(adjustCfg);\n  // 关闭辅助 view 的轴\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false);\n  // 关闭辅助 view 的图例\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n  return params;\n}\n/**\n * meta 配置\n */\nfunction meta(params) {\n  var _a;\n  var chart = params.chart,\n    options = params.options;\n  var meta = options.meta,\n    xAxis = options.xAxis,\n    yAxis = options.yAxis;\n  var baseMeta = {};\n  var scales = deepAssign(baseMeta, meta, (_a = {}, _a[X_FIELD] = __assign(__assign({\n    sync: true\n  }, pick(xAxis, AXIS_META_CONFIG_KEYS)), {\n    // fix:  dodge is not support linear attribute, please use category attribute!\n    // 强制 x 轴类型为分类类型\n    type: 'cat'\n  }), _a[VIOLIN_Y_FIELD] = __assign({\n    sync: true\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MIN_MAX_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[QUANTILE_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a[MEDIAN_FIELD] = __assign({\n    sync: VIOLIN_Y_FIELD\n  }, pick(yAxis, AXIS_META_CONFIG_KEYS)), _a));\n  chart.scale(scales);\n  return params;\n}\n/**\n * axis 配置\n */\nfunction axis(params) {\n  var chart = params.chart,\n    options = params.options;\n  var xAxis = options.xAxis,\n    yAxis = options.yAxis;\n  var view = findViewById(chart, VIOLIN_VIEW_ID);\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n  chart.axis(false);\n  return params;\n}\n/**\n *\n * @param params\n * @returns\n */\nfunction legend(params) {\n  var chart = params.chart,\n    options = params.options;\n  var legend = options.legend,\n    seriesField = options.seriesField,\n    shape = options.shape;\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    var legendField_1 = seriesField ? seriesField : X_FIELD;\n    // fixme 暂不明为啥有描边\n    var legendOptions = omit(legend, ['selected']);\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n    chart.legend(legendField_1, legendOptions);\n    // 特殊的处理 fixme G2 层得解决这个问题\n    if (get(legend, 'selected')) {\n      each(chart.views, function (view) {\n        return view.legend(legendField_1, legend);\n      });\n    }\n  }\n  return params;\n}\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\nfunction annotation(params) {\n  var chart = params.chart;\n  var violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()(__assign(__assign({}, params), {\n    chart: violinView\n  }));\n  return params;\n}\n/**\n * 动画\n * @param params\n */\nexport function animation(params) {\n  var chart = params.chart,\n    options = params.options;\n  var animation = options.animation;\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(chart.views, function (view) {\n    addViewAnimation(view, animation);\n  });\n  return params;\n}\n/**\n * 小提琴图适配器\n * @param params\n */\nexport function adaptor(params) {\n  return flow(theme, data, violinView, boxView, meta, tooltip, axis, legend, interaction, annotation, animation)(params);\n}","map":{"version":3,"mappings":"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","names":["each","get","omit","set","annotation","baseAnnotation","interaction","theme","tooltip","interval","point","violin","AXIS_META_CONFIG_KEYS","deepAssign","findViewById","flow","pick","addViewAnimation","MEDIAN_FIELD","MEDIAN_VIEW_ID","MIN_MAX_FIELD","MIN_MAX_VIEW_ID","QUANTILE_FIELD","QUANTILE_VIEW_ID","VIOLIN_SIZE_FIELD","VIOLIN_VIEW_ID","VIOLIN_Y_FIELD","X_FIELD","transformViolinData","TOOLTIP_FIELDS","adjustCfg","type","marginRatio","data","params","options","chart","violinView","color","_a","shape","violinStyle","state","view","createView","id","xField","yField","seriesField","sizeField","fields","style","geometries","adjust","boxView","box","minMaxView","size","lineWidth","quantileView","fillOpacity","medianView","fill","axis","legend","meta","xAxis","yAxis","baseMeta","scales","sync","scale","legendField_1","legendOptions","startsWith","views","animation","adaptor"],"sources":["C:\\Users\\sandeep dangi\\OneDrive\\Desktop\\6th sem\\3rd sem\\company que\\react project\\admin-app\\node_modules\\@antv\\g2plot\\src\\plots\\violin\\adaptor.ts"],"sourcesContent":["import { each, get, omit, set } from '@antv/util';\nimport { annotation as baseAnnotation, interaction, theme, tooltip } from '../../adaptor/common';\nimport { interval, point, violin } from '../../adaptor/geometries';\nimport { AXIS_META_CONFIG_KEYS } from '../../constant';\nimport { Params } from '../../core/adaptor';\nimport { deepAssign, findViewById, flow, pick } from '../../utils';\nimport { addViewAnimation } from '../../utils/view';\nimport {\n  MEDIAN_FIELD,\n  MEDIAN_VIEW_ID,\n  MIN_MAX_FIELD,\n  MIN_MAX_VIEW_ID,\n  QUANTILE_FIELD,\n  QUANTILE_VIEW_ID,\n  VIOLIN_SIZE_FIELD,\n  VIOLIN_VIEW_ID,\n  VIOLIN_Y_FIELD,\n  X_FIELD,\n} from './constant';\nimport { ViolinOptions } from './types';\nimport { transformViolinData } from './utils';\n\nconst TOOLTIP_FIELDS = ['low', 'high', 'q1', 'q3', 'median'];\n\nconst adjustCfg = [\n  {\n    type: 'dodge',\n    marginRatio: 1 / 32,\n  } as const,\n];\n\n/** 处理数据 */\nfunction data(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  chart.data(transformViolinData(options));\n  return params;\n}\n\n/** 小提琴轮廓 */\nfunction violinView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, shape = 'violin', violinStyle, tooltip, state } = options;\n\n  const view = chart.createView({ id: VIOLIN_VIEW_ID });\n  violin({\n    chart: view,\n    options: {\n      xField: X_FIELD,\n      yField: VIOLIN_Y_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      sizeField: VIOLIN_SIZE_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      violin: {\n        style: violinStyle,\n        color,\n        shape,\n      },\n      state,\n    },\n  });\n  view.geometries[0].adjust(adjustCfg);\n\n  return params;\n}\n\n/** 箱线 */\nfunction boxView(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { seriesField, color, tooltip, box } = options;\n\n  // 如果配置 `box` 为 false ，不渲染内部箱线图\n  if (box === false) return params;\n\n  // 边缘线\n  const minMaxView = chart.createView({ id: MIN_MAX_VIEW_ID });\n  interval({\n    chart: minMaxView,\n    options: {\n      xField: X_FIELD,\n      yField: MIN_MAX_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 1,\n        style: {\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  minMaxView.geometries[0].adjust(adjustCfg);\n\n  // 四分点位\n  const quantileView = chart.createView({ id: QUANTILE_VIEW_ID });\n  interval({\n    chart: quantileView,\n    options: {\n      xField: X_FIELD,\n      yField: QUANTILE_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      interval: {\n        color,\n        size: 8,\n        style: {\n          fillOpacity: 1,\n        },\n      },\n    },\n  });\n  quantileView.geometries[0].adjust(adjustCfg);\n\n  // 中位值\n  const medianView = chart.createView({ id: MEDIAN_VIEW_ID });\n  point({\n    chart: medianView,\n    options: {\n      xField: X_FIELD,\n      yField: MEDIAN_FIELD,\n      seriesField: seriesField ? seriesField : X_FIELD,\n      tooltip: {\n        fields: TOOLTIP_FIELDS,\n        ...tooltip,\n      },\n      state: typeof box === 'object' ? box.state : {},\n      point: {\n        color,\n        size: 1,\n        style: {\n          fill: 'white',\n          lineWidth: 0,\n        },\n      },\n    },\n  });\n  medianView.geometries[0].adjust(adjustCfg);\n\n  // 关闭辅助 view 的轴\n  quantileView.axis(false);\n  minMaxView.axis(false);\n  medianView.axis(false);\n\n  // 关闭辅助 view 的图例\n  medianView.legend(false);\n  minMaxView.legend(false);\n  quantileView.legend(false);\n\n  return params;\n}\n\n/**\n * meta 配置\n */\nfunction meta(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { meta, xAxis, yAxis } = options;\n\n  const baseMeta = {};\n\n  const scales = deepAssign(baseMeta, meta, {\n    [X_FIELD]: {\n      sync: true,\n      ...pick(xAxis, AXIS_META_CONFIG_KEYS),\n      // fix:  dodge is not support linear attribute, please use category attribute!\n      // 强制 x 轴类型为分类类型\n      type: 'cat',\n    },\n    [VIOLIN_Y_FIELD]: {\n      sync: true,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MIN_MAX_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [QUANTILE_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n    [MEDIAN_FIELD]: {\n      sync: VIOLIN_Y_FIELD,\n      ...pick(yAxis, AXIS_META_CONFIG_KEYS),\n    },\n  });\n\n  chart.scale(scales);\n\n  return params;\n}\n\n/**\n * axis 配置\n */\nfunction axis(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { xAxis, yAxis } = options;\n\n  const view = findViewById(chart, VIOLIN_VIEW_ID);\n\n  // 为 false 则是不显示轴\n  if (xAxis === false) {\n    view.axis(X_FIELD, false);\n  } else {\n    view.axis(X_FIELD, xAxis);\n  }\n\n  if (yAxis === false) {\n    view.axis(VIOLIN_Y_FIELD, false);\n  } else {\n    view.axis(VIOLIN_Y_FIELD, yAxis);\n  }\n\n  chart.axis(false);\n\n  return params;\n}\n\n/**\n *\n * @param params\n * @returns\n */\nfunction legend(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { legend, seriesField, shape } = options;\n\n  if (legend === false) {\n    chart.legend(false);\n  } else {\n    const legendField = seriesField ? seriesField : X_FIELD;\n    // fixme 暂不明为啥有描边\n    const legendOptions = omit(legend as any, ['selected']);\n    if (!shape || !shape.startsWith('hollow')) {\n      if (!get(legendOptions, ['marker', 'style', 'lineWidth'])) {\n        set(legendOptions, ['marker', 'style', 'lineWidth'], 0);\n      }\n    }\n    chart.legend(legendField, legendOptions);\n    // 特殊的处理 fixme G2 层得解决这个问题\n    if (get(legend, 'selected')) {\n      each(chart.views, (view) => view.legend(legendField, legend));\n    }\n  }\n\n  return params;\n}\n\n/**\n * annotation, apply to violin view.\n * @param params\n * @returns\n */\nfunction annotation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart } = params;\n\n  const violinView = findViewById(chart, VIOLIN_VIEW_ID);\n  baseAnnotation()({ ...params, chart: violinView });\n\n  return params;\n}\n\n/**\n * 动画\n * @param params\n */\nexport function animation(params: Params<ViolinOptions>): Params<ViolinOptions> {\n  const { chart, options } = params;\n  const { animation } = options;\n\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(chart.views, (view) => {\n    addViewAnimation(view, animation);\n  });\n\n  return params;\n}\n\n/**\n * 小提琴图适配器\n * @param params\n */\nexport function adaptor(params: Params<ViolinOptions>) {\n  return flow(\n    theme,\n    data,\n    violinView,\n    boxView,\n    meta,\n    tooltip,\n    axis,\n    legend,\n    interaction,\n    annotation,\n    animation\n  )(params);\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}